{% extends 'index.html' %}
{% block css %}
    <style>
        .hide{
            display: none;
        }
    </style>
{% endblock %}
{% block content %}
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12">
                        <div class="card">
                            <div class="card-header">
                                <i class="fa fa-edit"></i>添加定时任务
                                <div class="card-actions">
                                    <a href="#" class="btn-setting"><i class="icon-settings"></i></a>
                                    <a href="#" class="btn-minimize"><i class="icon-arrow-up"></i></a>
                                    <a href="#" class="btn-close"><i class="icon-close"></i></a>
                                </div>
                            </div>
                            <div class="col-sm-12">

                                        <div class="form-group" style="margin-top: 10px">
                                            <label for="name">当前连接IP地址</label>
                                            <input type="text" id="ip" class="form-control" name="disabled-input" value="{{ host_ip }}">
                                        </div>

                            </div>

                                <div class="row">

                                <div class="col-sm-2" style="margin-left: 15px">
                                    <div class="form-group">
                                        <label for="cvv">参数一</label>
                                        <input type="text" class="form-control" id="crontab_time" style="width: 159px" value="20180301">
                                    </div>
                                </div>

                                    <div class="col-sm-2" style="margin-left: 15px">
                                    <div class="form-group">
                                        <label for="cvv">参数二</label>
                                        <input type="text" class="form-control" id="crontab_1" style="width: 159px" value="160000">
                                    </div>
                                </div>

                                    <div class="col-sm-2" style="margin-left: 15px">
                                    <div class="form-group">
                                        <label for="cvv">参数三</label>
                                        <input type="text" class="form-control" id="crontab_2" style="width: 159px" value="7200">
                                    </div>
                                </div>

                            </div>
                                <div class="row">
                                    <div class="form-group col-sm-3" style="margin-left: 15px">
                                    <button id="e" type="button" class="btn btn-primary" style="margin-top: 20px; width: 90px" onclick="get_record()">读取</button>
                                    <button id="check_time" type="button" class="btn btn-success" style="margin-top: 20px; width: 90px">新增</button>

                                    </div>

                                    <div class="form-group col-sm-3">
                                    </div>
                                    <div class="form-group col-sm-3">
                                    </div>
                                    </div>
                                </div>
                            </div>
                            <!--/.col-->
                        </div>
    </div>
    <div class="container-fluid">
        <div class="row">
        <div class="col-sm-6 col-md-12">
                                <div class="card card-accent-success">
                                    <div class="card-header">
                                        当前定时任务记录
                                        <img id="reload_ing" style="margin-left: 10px; margin-top: -3px" class="icon-reload float-right hide" alt="loadding" src="/static/img/reload_24.gif">
                                        <img id="reload_end" style="margin-left: 10px; margin-top: -3px" class="icon-reload float-right" alt="loadding" src="/static/img/reload_2.png">
                                        <span id="num" class="badge badge-pill badge-info float-right">0</span>
                                    </div>
                                    <div id="ppp" class="card-block">
                                    </div>
                                </div>
                            </div>
        </div>
    </div>


{% endblock %}
{% block js %}
    <script>
        get_record();
        // GET获取屏蔽时间列表
        function get_record() {
            var ip = $('#ip').val();
            $('#reload_ing').removeClass('hide');
            $('#reload_end').addClass('hide');
            var str_1 = "<a class='badge badge-pill badge-danger float-right' style='margin-right: 36px; color:white' onclick=del_record(this)>-</a>";
            $('#ppp').empty();
            $.ajax({
                url: '/crontab/',
                type: 'GET',
                data: {'ip': ip},
                dataType: 'JSON',
                success: function (response) {
                    if(response.status){
                        $('#reload_ing').addClass('hide');
                        $('#reload_end').removeClass('hide');
                        for(var i in response.data){
                          $('#ppp').append("<p>" + response.data[i] + str_1 + "</p>");
                          $('#num').text(i);
                        }
                    }else {
                        $('#alert-danger').removeClass('hide');
                        $('#error').text(response.error)
                    }
                }
            });
        }

{#        function del_record(ths) {#}
{#            var name = $(ths).parent().text();#}
{#            var ip = $('#ip').val();#}
{#            $.ajax({#}
{#                    url: '/crontab/',#}
{#                    type: 'POST',#}
{#                    data: {'ip': ip, 'is_del': 1, 'name': name},#}
{#                    dataType: 'JSON',#}
{#                    success: function (response) {#}
{#                        if(response.status){#}
{#                            $('#alert-warning').addClass('hide');#}
{#                            $('#alert-danger').addClass('hide');#}
{#                            $('#alert-success').addClass('hide');#}
{#                            $('#alert-del').removeClass('hide');#}
{#                            get_record();#}
{#                        }else {#}
{#                            $('#alert-danger').removeClass('hide');#}
{#                            $('#error').text(response.error)#}
{#                        }#}
{#                    }#}
{#                })#}
{#        }#}

        // 添加记录
        $('#check_time').click(function () {
            var ip = $('#ip').val();
            var crontab_time = $('#crontab_time').val();
            var crontab_1 = $('#crontab_1').val();
            var crontab_2 = $('#crontab_2').val();
            if(crontab_time==''){
                $('#alert-warning').removeClass('hide');
                $('#warning_text').text('屏蔽时间不能为空...');
                return false;
            }
            $.ajax({
                    url: '/crontab/',
                    type: 'POST',
                    data: {'ip': ip, 'crontab_time': crontab_time, 'crontab_1': crontab_1, 'crontab_2': crontab_2},
                    dataType: 'JSON',
                    success: function (response) {
                        if(response.status){
                            $('#alert-warning').addClass('hide');
                            $('#alert-danger').addClass('hide');
                            $('#alert-success').removeClass('hide');
                            get_record();
                        }else {
                            $('#alert-danger').removeClass('hide');
                            $('#error').text(response.error)
                        }
                    }
                })
        })


    </script>
{% endblock %}